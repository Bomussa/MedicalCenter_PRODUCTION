# سجل التغييرات (CHANGELOG)

## [1.0.1] - 2025-09-22

### مضاف

*   **تنفيذ المصادقة الثنائية (2FA)**:
    *   إضافة حقل `isTwoFactorEnabled` و `twoFactorSecret` إلى نموذج المستخدم.
    *   تطبيق مسارات API جديدة لإنشاء سر 2FA، وتمكين/تعطيل 2FA.
    *   تعديل مسار تسجيل الدخول للتحقق من رمز 2FA عند تمكينه.
*   **إضافة التحقق من صحة الإدخال**: 
    *   دمج `express-validator` للتحقق القوي من صحة الإدخال عبر جميع نقاط نهاية API (المستخدمين، العيادات، الاختبارات).
    *   ضمان سلامة البيانات وتحسين معالجة الأخطاء للمدخلات غير الصالحة.
*   **تحسين تسجيل الأخطاء والتعامل معها**:
    *   دمج `winston` لتسجيل الأخطاء المنظم.
    *   تطبيق برنامج وسيط مركزي لمعالجة الأخطاء في `server.js`.
    *   استبدال `console.error` بـ `logger.error` للإبلاغ المتسق عن الأخطاء.
*   **توثيق API باستخدام Swagger/OpenAPI**:
    *   دمج `swagger-jsdoc` و `swagger-ui-express`.
    *   إنشاء `swagger.js` لتكوين API وتعريفات المخطط.
    *   إضافة تعليقات JSDoc شاملة لجميع مسارات API لتوليد التوثيق التلقائي.
    *   يمكن الوصول إلى واجهة مستخدم Swagger عبر `/api-docs`.
*   **تنفيذ الحد من المعدل (Rate Limiting)**:
    *   دمج `express-rate-limit` لحماية نقاط نهاية API.
    *   تطبيق `generalLimiter` على جميع الطلبات.
    *   تطبيق `loginLimiter` لنقطة نهاية تسجيل الدخول لمنع هجمات القوة الغاشمة.
    *   تطبيق `twoFactorGenerateLimiter` لنقطة نهاية إنشاء 2FA لمنع إساءة الاستخدام.
*   **التحقق من اتساق البيانات في نموذج Exam**:
    *   إضافة `timestamps: true` إلى مخطط `Exam`.
    *   تطبيق خطافات `pre-save` و `pre-findOneAndUpdate` في نموذج `Exam` لتحديث `clinicCount` تلقائيًا بناءً على طول مصفوفة `clinics`، مما يضمن اتساق البيانات.
*   **إضافة الترحيل (Pagination)**:
    *   تطبيق الترحيل على نقاط نهاية `GET /api/users` و `GET /api/clinics` و `GET /api/exams`.
    *   تعديل تعليقات JSDoc لنقاط النهاية المتأثرة لتعكس معلمات `page` و `limit` في الاستجابة.

## [1.0.0] - 2025-09-22

### مضاف

*   هيكل المشروع الأولي لـ AttarMedical Backend.
*   نماذج Mongoose للمستخدمين والعيادات والاختبارات.
*   نقاط نهاية API للمستخدمين (تسجيل الدخول، CRUD للمسؤولين).
*   نقاط نهاية API للعيادات (CRUD).
*   نقاط نهاية API للاختبارات (CRUD، تصفية حسب الجنس).
*   مصادقة JWT والترخيص المستند إلى الدور.
*   ملفات تكوين Jest للاختبارات.
*   ملف `.env` لإدارة متغيرات البيئة.

### متغير

*   تم تحسين التعامل مع الأخطاء الأساسي في المسارات.

### ثابت

*   لا توجد إصلاحات أخطاء محددة في هذا الإصدار الأولي.

### أمان

*   تطبيق المصادقة المستندة إلى JWT.
*   تطبيق التحقق من الدور للمسؤولين والمسؤولين الخارقين.

