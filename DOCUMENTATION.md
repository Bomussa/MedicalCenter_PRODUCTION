# دليل المطور الشامل - نظام المركز الطبي العسكري

## نظرة عامة على المشروع

نظام المركز الطبي العسكري هو تطبيق ويب متكامل لإدارة الفحوصات الطبية العسكرية. يتكون النظام من واجهة أمامية تفاعلية مبنية بـ React وواجهة خلفية قوية مبنية بـ Node.js و TypeScript.

## هيكل المشروع

### الواجهة الأمامية (Frontend)
```
medical-test/
├── src/
│   ├── App.jsx                 # المكون الرئيسي للتطبيق
│   ├── main.jsx               # نقطة دخول التطبيق
│   ├── App.css               # ملف الأنماط الرئيسي
│   └── components/
│       └── ui/               # مكونات واجهة المستخدم
├── index.html                # صفحة HTML الرئيسية
├── package.json              # تبعيات المشروع
└── vite.config.js           # إعدادات Vite
```

### الواجهة الخلفية (Backend)
```
backend/
├── src/
│   ├── index.ts              # الخادم الرئيسي
│   ├── controllers/          # وحدات التحكم
│   │   ├── authController.ts
│   │   ├── adminController.ts
│   │   └── analyticsController.ts
│   ├── routes/               # مسارات API
│   │   ├── auth.ts
│   │   ├── admin.ts
│   │   ├── visitor.ts
│   │   ├── exam.ts
│   │   └── analytics.ts
│   ├── services/             # الخدمات
│   │   └── reportService.ts
│   ├── middleware/           # الوسطاء
│   │   └── auth.ts
│   └── cron/                # المهام المجدولة
│       └── scheduler.ts
├── prisma/
│   └── schema.prisma        # مخطط قاعدة البيانات
├── package.json             # تبعيات الخادم
└── .env                     # متغيرات البيئة
```

## الميزات الرئيسية

### رحلة المراجع (Public Flow)

#### الخطوة الأولى: تسجيل البيانات
يبدأ المراجع بإدخال الرقم العسكري أو الشخصي واختيار الجنس. إذا اختار المراجع "أنثى"، يظهر إشعار خاص يوجهها إلى استقبال المركز الطبي مع تشغيل رسالة صوتية أنثوية واضحة.

#### الخطوة الثانية: اختيار نوع الفحص
يختار المراجع من بين ستة أنواع فحوصات: التجنيد، الترفيع، النقل، التحويل، الطيران، والطباخين. كل نوع فحص له مسار طبي مخصص.

#### الخطوة الثالثة: المسار الطبي التفاعلي
يعرض النظام المسار الطبي الكامل مع شريط تقدم، رقم الدور الحالي، مؤقت زمني، وقائمة العيادات المطلوبة. العيادات تشمل المختبر، القلب، العيون، الأنف والأذن والحنجرة، والأسنان.

### لوحة الإدارة

#### إحصائيات مباشرة
تعرض لوحة الإدارة إحصائيات اليوم الحالي بما في ذلك عدد الزوار، العيادات النشطة، والفحوصات المكتملة.

#### إدارة الأكواد اليومية
تعرض الأكواد اليومية لجميع العيادات مع إمكانية تجديدها بنقرة واحدة. الأكواد تتغير تلقائياً كل يوم في الساعة 5 صباحاً.

#### أدوات الإدارة
تتضمن أزرار للعودة للواجهة الرئيسية واختبار النظام الصوتي.

## التقنيات المستخدمة

### الواجهة الأمامية
- **React 18**: مكتبة JavaScript لبناء واجهات المستخدم
- **Vite**: أداة بناء سريعة للتطوير
- **Tailwind CSS**: إطار عمل CSS للتصميم
- **Lucide React**: مكتبة الأيقونات
- **shadcn/ui**: مكونات واجهة المستخدم

### الواجهة الخلفية
- **Node.js**: بيئة تشغيل JavaScript
- **TypeScript**: لغة برمجة مع أنواع البيانات
- **Express.js**: إطار عمل الخادم
- **Prisma**: ORM لقاعدة البيانات
- **SQLite**: قاعدة البيانات
- **JWT**: للمصادقة والتوكينات
- **bcrypt**: لتشفير كلمات المرور
- **node-cron**: للمهام المجدولة

## قاعدة البيانات

### الجداول الرئيسية

#### جدول المستخدمين (User)
يحتوي على بيانات المستخدمين الإداريين مع الأدوار والصلاحيات.

#### جدول الزوار (Visitor)
يخزن بيانات المراجعين بما في ذلك الرقم العسكري، الجنس، ونوع الفحص.

#### جدول الزيارات (Visit)
يتتبع رحلة المراجع عبر العيادات المختلفة.

#### جدول العيادات (Clinic)
يحتوي على معلومات العيادات والأكواد اليومية.

#### جدول أنواع الفحوصات (ExamType)
يحدد أنواع الفحوصات المختلفة ومساراتها الطبية.

#### جدول المسارات الطبية (MedicalPath)
يربط أنواع الفحوصات بالعيادات المطلوبة.

#### جدول سجل المراجعة (AuditLog)
يسجل جميع العمليات المهمة في النظام.

## API Endpoints

### المصادقة (/api/auth)
- `POST /login`: تسجيل الدخول
- `POST /logout`: تسجيل الخروج
- `GET /me`: الحصول على بيانات المستخدم الحالي

### الإدارة (/api/admin)
- `GET /stats`: إحصائيات النظام
- `GET /users`: قائمة المستخدمين
- `POST /users`: إضافة مستخدم جديد
- `PUT /users/:id`: تحديث مستخدم
- `DELETE /users/:id`: حذف مستخدم

### الزوار (/api/visitor)
- `POST /register`: تسجيل مراجع جديد
- `POST /visit`: بدء زيارة جديدة
- `PUT /visit/:id/next`: الانتقال للعيادة التالية

### الفحوصات (/api/exam)
- `GET /types`: أنواع الفحوصات
- `GET /path/:type`: المسار الطبي لنوع فحص

### التحليلات (/api/analytics)
- `GET /daily`: إحصائيات يومية
- `GET /reports`: تقارير مفصلة

## الأمان والحماية

### المصادقة
النظام يستخدم JWT للمصادقة مع انتهاء صلاحية 12 ساعة. كلمات المرور مشفرة باستخدام bcrypt.

### الصلاحيات
يدعم النظام أربعة مستويات صلاحيات: SUPER_ADMIN، ADMIN، DOCTOR، NURSE.

### الحماية
تطبيق Helmet.js للحماية من الهجمات الشائعة، وإعدادات CORS محكمة.

## التشغيل والصيانة

### متطلبات النظام
- Node.js 18 أو أحدث
- npm أو pnpm
- SQLite

### تثبيت التبعيات
```bash
# الواجهة الأمامية
cd medical-test
pnpm install

# الواجهة الخلفية
cd backend
npm install
```

### تشغيل النظام
```bash
# الواجهة الخلفية
cd backend
npm run dev

# الواجهة الأمامية
cd medical-test
pnpm run dev
```

### إعداد قاعدة البيانات
```bash
cd backend
npx prisma generate
npx prisma db push
node seed.js
```

## الصيانة المستقبلية

### إضافة عيادة جديدة
1. تحديث جدول Clinic في قاعدة البيانات
2. إضافة العيادة في المسارات الطبية المناسبة
3. تحديث واجهة المستخدم لعرض العيادة الجديدة

### إضافة نوع فحص جديد
1. إضافة النوع في جدول ExamType
2. تحديد المسار الطبي في جدول MedicalPath
3. تحديث واجهة اختيار نوع الفحص

### تحديث الأكواد اليومية
الأكواد تتجدد تلقائياً عبر مجدول المهام، ولكن يمكن تجديدها يدوياً من لوحة الإدارة.

## استكشاف الأخطاء

### مشاكل شائعة
- **خطأ في الاتصال بقاعدة البيانات**: تأكد من وجود ملف .env وصحة المسار
- **فشل المصادقة**: تحقق من صحة JWT_SECRET
- **مشاكل CORS**: تأكد من إعدادات CORS في الخادم

### ملفات السجل
النظام يسجل جميع العمليات في جدول AuditLog لسهولة التتبع والصيانة.

## الخلاصة

هذا النظام مصمم ليكون قابلاً للتوسع والصيانة مع هيكل واضح ومنظم. جميع المكونات موثقة ومنظمة بطريقة تسهل التطوير المستقبلي والصيانة.

